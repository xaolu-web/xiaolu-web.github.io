<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰«é›·</title>
    <style>
        .cell {
            width: 30px;
            height: 30px;
            float: left;
            border: 1px solid #999;
            text-align: center;
            line-height: 30px;
            cursor: pointer;
            background-color: #ddd;
        }
        .cell.revealed {
            background-color: #bbb;
            cursor: default;
        }
        .cell.mine {
            background-color: red;
        }
        .cell.mine:after {
            content: "ğŸ’£";
        }
        .cell.number-1 { color: blue; }
        .cell.number-2 { color: green; }
        .cell.number-3 { color: red; }
        .cell.number-4 { color: purple; }
        .cell.number-5 { color: maroon; }
    </style>
</head>
<body>
    <h1>ç®€æ˜“æ‰«é›·</h1>
    <div id="board" style="width: 300px; margin: 0 auto;"></div>
    <button id="reset">é‡æ–°å¼€å§‹</button>
    <script>
        // æ¸¸æˆé…ç½®ï¼š10x10ç½‘æ ¼ï¼Œ10ä¸ªåœ°é›·
        const size = 10;
        const mineCount = 10;
        let board = [];
        let revealed = [];
        
        // åˆå§‹åŒ–æ¸¸æˆ
        function init() {
            board = Array(size).fill().map(() => Array(size).fill(0));
            revealed = Array(size).fill().map(() => Array(size).fill(false));
            
            // éšæœºæ”¾ç½®åœ°é›·
            let minesPlaced = 0;
            while (minesPlaced < mineCount) {
                const row = Math.floor(Math.random() * size);
                const col = Math.floor(Math.random() * size);
                if (board[row][col] !== -1) {
                    board[row][col] = -1;
                    minesPlaced++;
                }
            }
            
            // è®¡ç®—æ¯ä¸ªæ ¼å­å‘¨å›´çš„åœ°é›·æ•°
            for (let row = 0; row < size; row++) {
                for (let col = 0; col < size; col++) {
                    if (board[row][col] === -1) continue;
                    let count = 0;
                    for (let r = row-1; r <= row+1; r++) {
                        for (let c = col-1; c <= col+1; c++) {
                            if (r >=0 && r < size && c >=0 && c < size && board[r][c] === -1) {
                                count++;
                            }
                        }
                    }
                    board[row][col] = count;
                }
            }
            
            // æ¸²æŸ“æ£‹ç›˜
            const boardEl = document.getElementById('board');
            boardEl.innerHTML = '';
            for (let row = 0; row < size; row++) {
                for (let col = 0; col < size; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = row;
                    cell.dataset.col = col;
                    cell.addEventListener('click', () => clickCell(row, col));
                    boardEl.appendChild(cell);
                }
            }
        }
        
        // ç‚¹å‡»æ ¼å­å¤„ç†
        function clickCell(row, col) {
            if (revealed[row][col]) return;
            revealed[row][col] = true;
            
            const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
            cell.classList.add('revealed');
            
            if (board[row][col] === -1) {
                // è¸©åˆ°åœ°é›·ï¼Œæ¸¸æˆç»“æŸ
                cell.classList.add('mine');
                alert('æ¸¸æˆç»“æŸï¼è¸©åˆ°åœ°é›·äº†');
                revealAllMines();
                return;
            }
            
            if (board[row][col] > 0) {
                cell.classList.add(`number-${board[row][col]}`);
                cell.textContent = board[row][col];
            } else {
                // é€’å½’ç¿»å¼€å‘¨å›´æ ¼å­
                for (let r = row-1; r <= row+1; r++) {
                    for (let c = col-1; c <= col+1; c++) {
                        if (r >=0 && r < size && c >=0 && c < size) {
                            clickCell(r, c);
                        }
                    }
                }
            }
            
            // æ£€æŸ¥æ˜¯å¦èƒœåˆ©
            checkWin();
        }
        
        // æ˜¾ç¤ºæ‰€æœ‰åœ°é›·
        function revealAllMines() {
            for (let row = 0; row < size; row++) {
                for (let col = 0; col < size; col++) {
                    if (board[row][col] === -1 && !revealed[row][col]) {
                        const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
                        cell.classList.add('revealed', 'mine');
                    }
                }
            }
        }
        
        // æ£€æŸ¥æ˜¯å¦èƒœåˆ©
        function checkWin() {
            const totalCells = size * size;
            const safeCells = totalCells - mineCount;
            const revealedCells = revealed.flat().filter(v => v).length;
            
            if (revealedCells === safeCells) {
                alert('æ­å–œä½ èƒœåˆ©äº†ï¼');
            }
        }
        
        // é‡ç½®æ¸¸æˆ
        document.getElementById('reset').addEventListener('click', init);
        
        // å¯åŠ¨æ¸¸æˆ
        init();
    </script>
</body>
</html>